#ifndef Motor_Handler_h
#define Motor_Handler_h


#include "arduino.h"



#define WAIT_CONSTANT_ONE               54
#define WAIT_CONSTANT_TWO               56                  //57
#define WAIT_CONSTANT_THREE             44                  //43

#define GPIO_MOT_ONE                    32
#define CLR_MOT_ONE                     GPIO.out1_w1tc.val |= 1 //Pin32 2^(32-32)
#define SET_MOT_ONE                     GPIO.out1_w1ts.val |= 1

#define GPIO_MOT_TWO                    33
#define CLR_MOT_TWO                     GPIO.out1_w1tc.val |= 2 //Pin33 2^(33-32)
#define SET_MOT_TWO                     GPIO.out1_w1ts.val |= 2

#define GPIO_MOT_THREE                  26
#define CLR_MOT_THREE                   GPIO.out_w1tc |= 67108864 //Pin26 2^26
#define SET_MOT_THREE                   GPIO.out_w1ts |= 67108864

#define GPIO_MOT_FOUR                   27
#define CLR_MOT_FOUR                    GPIO.out_w1tc |= 134217728 //Pin27: 2^27
#define SET_MOT_FOUR                    GPIO.out_w1ts |= 134217728

#define MAXIMAL_MOTOR_VALUE             950
#define MINIMAL_MOTOR_VALUE             100

#define MAXIMAL_MOTOR_ADJUSTMENT_RATE   100



/*
            .
           / \    Front
            |
            |

       M2       M1
         \     /
          X---X
          X---X
          X---X
          X---X
         /     \
       M4       M3



*/












class motorhandler  {
public:

    motorhandler();
    void writeToMotorsSave(volatile uint16_t* throttle);
    void armMotors();
    void disarmMotors();
    int getDshotLookup(int ThrustValue);
    
    
    
    // min max check
 
private:
    void WAIT_1();
    void WAIT_2();
    void WAIT_3();
    uint16_t createPacket(uint16_t throttlee);
    //save last throttle values 
    int m_last_throttles_M1;
    int m_last_throttles_M2;
    int m_last_throttles_M3;
    int m_last_throttles_M4;
    int m_isArmed=0;


    void writeToMotors(volatile uint16_t* throttle);


    int m_LookupDshot[1001] = {100,119,134,147,160,170,180,189,198,206,214,222,229,236,243,249,256,262,268,274,279,285,290,296,301,306,311,316,321,325,
330,335,339,343,348,352,357,361,365,369,373,377,381,385,389,393,396,400,404,408,411,415,418,422,425,429,432,436,439,442,
446,449,452,455,459,462,465,468,471,474,477,481,484,487,490,493,496,498,501,504,507,510,513,516,518,521,524,527,530,532,
535,538,540,543,546,548,551,554,556,559,561,564,567,569,572,574,577,579,582,584,587,589,591,594,596,599,601,603,606,608,
611,613,615,618,620,622,625,627,629,631,634,636,638,640,643,645,647,649,651,654,656,658,660,662,664,667,669,671,673,675,
677,679,681,684,686,688,690,692,694,696,698,700,702,704,706,708,710,712,714,716,718,720,722,724,726,728,730,732,734,736,
737,739,741,743,745,747,749,751,753,755,756,758,760,762,764,766,768,769,771,773,775,777,779,780,782,784,786,788,789,791,
793,795,796,798,800,802,804,805,807,809,811,812,814,816,817,819,821,823,824,826,828,829,831,833,835,836,838,840,841,843,
845,846,848,850,851,853,855,856,858,859,861,863,864,866,868,869,871,872,874,876,877,879,880,882,884,885,887,888,890,892,
893,895,896,898,899,901,903,904,906,907,909,910,912,913,915,916,918,919,921,922,924,926,927,929,930,932,933,935,936,938,
939,941,942,943,945,946,948,949,951,952,954,955,957,958,960,961,963,964,965,967,968,970,971,973,974,976,977,978,980,981,
983,984,986,987,988,990,991,993,994,995,997,998,1000,1001,1002,1004,1005,1007,1008,1009,1011,1012,1014,1015,1016,1018,1019,1020,1022,1023,
1024,1026,1027,1029,1030,1031,1033,1034,1035,1037,1038,1039,1041,1042,1043,1045,1046,1047,1049,1050,1051,1053,1054,1055,1057,1058,1059,1061,1062,1063,
1065,1066,1067,1068,1070,1071,1072,1074,1075,1076,1078,1079,1080,1081,1083,1084,1085,1087,1088,1089,1090,1092,1093,1094,1095,1097,1098,1099,1101,1102,
1103,1104,1106,1107,1108,1109,1111,1112,1113,1114,1116,1117,1118,1119,1121,1122,1123,1124,1126,1127,1128,1129,1130,1132,1133,1134,1135,1137,1138,1139,
1140,1141,1143,1144,1145,1146,1148,1149,1150,1151,1152,1154,1155,1156,1157,1158,1160,1161,1162,1163,1164,1166,1167,1168,1169,1170,1172,1173,1174,1175,
1176,1177,1179,1180,1181,1182,1183,1184,1186,1187,1188,1189,1190,1191,1193,1194,1195,1196,1197,1198,1200,1201,1202,1203,1204,1205,1206,1208,1209,1210,
1211,1212,1213,1215,1216,1217,1218,1219,1220,1221,1222,1224,1225,1226,1227,1228,1229,1230,1232,1233,1234,1235,1236,1237,1238,1239,1240,1242,1243,1244,
1245,1246,1247,1248,1249,1250,1251,1252,1253,1253,1254,1255,1256,1257,1258,1259,1260,1260,1261,1262,1263,1264,1265,1266,1267,1267,1269,1270,1272,1273,
1275,1276,1278,1279,1281,1282,1284,1285,1286,1288,1289,1291,1292,1294,1295,1297,1298,1300,1301,1303,1304,1306,1307,1309,1310,1312,1313,1315,1316,1318,
1319,1321,1322,1324,1325,1327,1328,1330,1331,1332,1334,1335,1337,1338,1340,1341,1343,1344,1346,1347,1349,1350,1352,1353,1355,1356,1358,1359,1361,1362,
1364,1365,1367,1368,1370,1371,1373,1374,1376,1377,1379,1380,1381,1383,1384,1386,1387,1389,1390,1392,1393,1395,1396,1398,1399,1401,1402,1404,1405,1407,
1408,1410,1411,1413,1414,1416,1417,1419,1420,1422,1423,1425,1426,1428,1429,1430,1432,1433,1435,1436,1438,1439,1441,1442,1444,1445,1447,1448,1450,1451,
1453,1454,1456,1457,1459,1460,1462,1463,1464,1466,1467,1468,1470,1471,1472,1474,1475,1476,1478,1479,1480,1482,1483,1484,1486,1487,1488,1490,1491,1492,
1494,1495,1496,1498,1499,1500,1502,1503,1504,1506,1507,1508,1510,1511,1512,1514,1515,1516,1518,1519,1520,1522,1523,1524,1526,1527,1528,1530,1531,1532,
1534,1535,1536,1538,1539,1540,1542,1543,1544,1546,1547,1548,1550,1551,1552,1554,1555,1556,1558,1559,1560,1562,1563,1564,1566,1567,1568,1570,1571,1572,
1574,1575,1576,1578,1579,1580,1582,1583,1584,1586,1587,1588,1590,1591,1592,1594,1595,1596,1598,1599,1600,1602,1603,1604,1606,1607,1608,1610,1611,1612,
1614,1615,1616,1618,1619,1620,1622,1623,1624,1626,1627,1628,1630,1631,1632,1634,1635,1636,1638,1639,1640,1642,1643,1644,1646,1647,1648,1650,1651,1652,
1654,1655,1656,1658,1660,1663,1665,1667,1669,1671,1674,1676,1678,1680,1682,1685,1687,1689,1691,1693,1696,1698,1700,1702,1705,1707,1709,1711,1713,1716,
1718,1720,1722,1724,1727,1729,1731,1733,1735,1738,1740,1742,1744,1746,1749,1751,1753,1755,1757,1760,1762,1764,1766,1769,1771,1773,1775,1777,1780,1782,
1784,1786,1788,1791,1793,1795,1797,1799,1802,1804,1806,1808,1810,1813,1815,1817,1819,1822,1824,1826,1828,1830,1833,1835,1837,1839,1841,1844,1846,1848,
1850,1853,1855,1858,1861,1864,1867,1869,1872,1875,1878,1881,1884,1886,1889,1892,1895,1898,1900,1903,1906,1909,1912,1914,1917,1920,1923,1926,1928,1931,
1934,1937,1940,1943,1945,1948,1951,1954,1957,1959,1962,1965,1968,1971,1973,1976,1979,1982,1985,1987,1990,1993,1996,1999,2002,2004,2007,2010,2013,2016,
2018,2021,2024,2027,2030,2032,2035,2038,2041,2044,2047};


   
    
    
};




#endif

